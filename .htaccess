# Metropol Portal - Production .htaccess
# Für firmenpro.de auf All-Inkl

# PHP 8.3 für All-Inkl
AddHandler application/x-httpd-php83 .php

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Erlaubt direkten Zugriff auf Debug/Install-Dateien
    RewriteRule ^(debug|check|install)\.php$ - [L]
    
    # Alles andere an index.php im Root
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php [L,QSA]
</IfModule>

# Verzeichnis-Browsing deaktivieren
Options -Indexes

# Sensible Dateien schützen
<FilesMatch "^\.">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# .env Datei schützen
<Files ".env">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</Files>

# Composer und npm Dateien schützen
<FilesMatch "(composer\.(json|lock)|package\.(json|lock)|package-lock\.json)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# PHP Einstellungen (falls erlaubt)
<IfModule mod_php.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 60
    php_value memory_limit 128M
    php_flag display_errors Off
    php_flag log_errors On
</IfModule>