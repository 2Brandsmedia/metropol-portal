#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run ESLint
echo "ğŸ“ Checking JavaScript/TypeScript code..."
npm run lint
if [ $? -ne 0 ]; then
    echo "âŒ ESLint check failed. Please fix the errors and try again."
    exit 1
fi

# Run TypeScript check
echo "ğŸ”· Checking TypeScript types..."
npm run typecheck
if [ $? -ne 0 ]; then
    echo "âŒ TypeScript check failed. Please fix the errors and try again."
    exit 1
fi

# Run PHP CodeSniffer
echo "ğŸ˜ Checking PHP code..."
composer run cs
if [ $? -ne 0 ]; then
    echo "âŒ PHP CodeSniffer check failed. Please fix the errors and try again."
    exit 1
fi

# Run PHPStan
echo "ğŸ”¬ Running PHP static analysis..."
composer run stan
if [ $? -ne 0 ]; then
    echo "âŒ PHPStan check failed. Please fix the errors and try again."
    exit 1
fi

# Run Prettier check
echo "âœ¨ Checking code formatting..."
npm run format:check
if [ $? -ne 0 ]; then
    echo "âŒ Code formatting check failed. Run 'npm run format' to fix."
    exit 1
fi

echo "âœ… All pre-commit checks passed!"