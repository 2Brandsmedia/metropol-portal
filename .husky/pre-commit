#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit checks..."

# Run ESLint
echo "📝 Checking JavaScript/TypeScript code..."
npm run lint
if [ $? -ne 0 ]; then
    echo "❌ ESLint check failed. Please fix the errors and try again."
    exit 1
fi

# Run TypeScript check
echo "🔷 Checking TypeScript types..."
npm run typecheck
if [ $? -ne 0 ]; then
    echo "❌ TypeScript check failed. Please fix the errors and try again."
    exit 1
fi

# Run PHP CodeSniffer
echo "🐘 Checking PHP code..."
composer run cs
if [ $? -ne 0 ]; then
    echo "❌ PHP CodeSniffer check failed. Please fix the errors and try again."
    exit 1
fi

# Run PHPStan
echo "🔬 Running PHP static analysis..."
composer run stan
if [ $? -ne 0 ]; then
    echo "❌ PHPStan check failed. Please fix the errors and try again."
    exit 1
fi

# Run Prettier check
echo "✨ Checking code formatting..."
npm run format:check
if [ $? -ne 0 ]; then
    echo "❌ Code formatting check failed. Run 'npm run format' to fix."
    exit 1
fi

echo "✅ All pre-commit checks passed!"